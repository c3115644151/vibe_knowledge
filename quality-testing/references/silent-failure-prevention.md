---
title: æ‹’ç»é™é»˜å¤±è´¥ä¸åˆå§‹åŒ–æ£€æŸ¥
type: pattern
keywords: debugging, silent-failure, initialization, logging, defensive-coding
---

# æ‹’ç»é™é»˜å¤±è´¥ä¸åˆå§‹åŒ–æ£€æŸ¥ (Silent Failure Prevention)

> **é—®é¢˜**: åŠŸèƒ½å®Œå…¨æ— å“åº”ï¼Œæ§åˆ¶å°æ— æŠ¥é”™ï¼Œæ’æŸ¥é™·å…¥æ­»èƒ¡åŒã€‚
> **åŸå› **: ä»£ç é™é»˜åæ‰äº†å¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚é…ç½®æœªåŠ è½½ã€æ•°æ®ä¸ºç©ºï¼‰ï¼Œå¯¼è‡´é€»è¾‘æ–­è·¯ä¸”æ— ä»»ä½•åé¦ˆã€‚

## 1. æ ¸å¿ƒåŸåˆ™ (Core Principles)

### A. Fail Loudly (å¤§å£°æŠ¥é”™)
å½“å…³é”®æ•°æ®ç¼ºå¤±æˆ–çŠ¶æ€å¼‚å¸¸æ—¶ï¼Œ**å®å¯æŠ¥é”™ä¹Ÿä¸è¦é™é»˜è¿”å›**ã€‚å¼€å‘é˜¶æ®µçš„æŠ¥é”™æ˜¯æœ‹å‹ï¼Œç”Ÿäº§ç¯å¢ƒçš„é™é»˜æ˜¯åœ°é›·ã€‚

*   **Anti-Pattern (åæ¨¡å¼)**:
    ```java
    WeaponData data = manager.getWeaponData(id);
    if (data == null) {
        return; // ğŸ’€ æ²¡æœ‰ä»»ä½•æç¤ºï¼Œç©å®¶åªä¼šè§‰å¾—â€œè¿™åŠŸèƒ½åäº†â€
    }
    ```

*   **Best Practice (æœ€ä½³å®è·µ)**:
    ```java
    WeaponData data = manager.getWeaponData(id);
    if (data == null) {
        plugin.getLogger().warning("Weapon data not found for ID: " + id); // ğŸš¨ æ˜ç¡®å‘ŠçŸ¥ç¼ºå¤±
        return;
    }
    ```

### B. Verify on Startup (å¯åŠ¨éªŒè¯)
ä¸è¦å‡è®¾ Manager å®ä¾‹åŒ–åå°±å¯ç”¨ã€‚å¿…é¡»åœ¨ `onEnable` é˜¶æ®µç¡®è®¤æ‰€æœ‰ Manager å·²æˆåŠŸåŠ è½½æ•°æ®ï¼Œå¹¶è¾“å‡ºç»Ÿè®¡æ—¥å¿—ã€‚

*   **Anti-Pattern (åæ¨¡å¼)**:
    ```java
    public void onEnable() {
        this.manager = new WeaponManager(this); // åªæ˜¯ new å‡ºæ¥äº†ï¼Œå¯èƒ½æ²¡åŠ è½½é…ç½®
        // å¿˜è®°è°ƒç”¨ manager.load();
    }
    ```

*   **Best Practice (æœ€ä½³å®è·µ)**:
    ```java
    public void onEnable() {
        this.manager = new WeaponManager(this);
        this.manager.load(); // æ˜¾å¼åŠ è½½
        // Manager å†…éƒ¨åº”è¯¥è¾“å‡º: "Loaded 15 weapons."
    }
    ```

## 2. å¸¸è§é™·é˜± (Common Pitfalls)

### The "Silent Return" (é™é»˜è¿”å›)
åœ¨äº‹ä»¶ç›‘å¬å™¨ä¸­ï¼Œç»å¸¸å‡ºç°å¤šå±‚ `if` åˆ¤æ–­ã€‚å¦‚æœå…¶ä¸­æŸä¸€å±‚åˆ¤æ–­å¤±è´¥ç›´æ¥ `return` è€Œä¸æ‰“æ—¥å¿—ï¼Œä¼šå¯¼è‡´æå…¶éš¾ä»¥æ’æŸ¥çš„é€»è¾‘é”™è¯¯ã€‚

**æ’æŸ¥æŠ€å·§**:
æš‚æ—¶å°†æ‰€æœ‰ `return` å‰åŠ ä¸Š `debug log`ï¼Œæˆ–è€…ä½¿ç”¨â€œå«è¯­å¥â€é£æ ¼å¹¶åœ¨å¤±è´¥æ—¶è¾“å‡º Warningï¼ˆä»…åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ï¼‰ã€‚

### The "Forgotten Loader" (è¢«é—å¿˜çš„åŠ è½½å™¨)
è®¸å¤š Manager å°† `load()` æ–¹æ³•ä¸æ„é€ å‡½æ•°åˆ†ç¦»ï¼ˆä¸ºäº†æ”¯æŒ `/reload` æŒ‡ä»¤ï¼‰ã€‚è¿™å®¹æ˜“å¯¼è‡´åœ¨ `onEnable` ä¸­åªå†™äº† `new Manager()` è€Œå¿˜äº†è°ƒç”¨ `load()`ã€‚

**è§£å†³æ–¹æ¡ˆ**:
*   åœ¨ Manager çš„æ„é€ å‡½æ•°ä¸­ç›´æ¥è°ƒç”¨ `load()`ï¼ˆå¦‚æœä¾èµ–å·²å°±ç»ªï¼‰ã€‚
*   æˆ–è€…åœ¨ `load()` æ–¹æ³•æœ«å°¾å¼ºåˆ¶è¾“å‡ºæ—¥å¿— `Loaded X items`ã€‚å¦‚æœå¯åŠ¨æ—¶æ²¡çœ‹åˆ°è¿™è¡Œæ—¥å¿—ï¼Œå°±èƒ½ç«‹åˆ»æ„è¯†åˆ°åˆå§‹åŒ–è¢«é—æ¼ã€‚

## 3. æ¡ˆä¾‹åˆ†æ (Case Study: HanaWeapons)

**ç°è±¡**: ç©å®¶æ‰‹æŒæ­¦å™¨å³é”®æ— æ³•è§¦å‘æ ¼æŒ¡ï¼Œæ§åˆ¶å°æ— ä»»ä½•æŠ¥é”™ã€‚
**æ’æŸ¥è¿‡ç¨‹**:
1.  æ€€ç–‘ NBT æ•°æ®æ³¨å…¥å¤±è´¥ -> æ·»åŠ æ—¥å¿—ï¼Œå‘ç°æ ¹æœ¬æ²¡è¿è¡Œåˆ°æ³¨å…¥ä»£ç ã€‚
2.  æ€€ç–‘äº‹ä»¶æœªè§¦å‘ -> æ·»åŠ æ—¥å¿—ï¼Œå‘ç°äº‹ä»¶è§¦å‘äº†ã€‚
3.  æ€€ç–‘æ¡ä»¶åˆ¤æ–­å¤±è´¥ -> é€æ­¥æ‰“å° `if` æ¡ä»¶ï¼Œå‘ç° `getWeaponData` è¿”å› nullã€‚
4.  **æ ¹æº**: `HanaWeapons` ä¸»ç±»åœ¨ `onEnable` ä¸­å®ä¾‹åŒ–äº† `WeaponManager` ä½†å¿˜è®°è°ƒç”¨ `loadWeapons()`ï¼Œå¯¼è‡´å†…å­˜ä¸­æ²¡æœ‰ä»»ä½•æ­¦å™¨æ•°æ®ã€‚ä¸” `WeaponListener` ä¸­å°† `data == null` çš„è­¦å‘Šæ—¥å¿—æ³¨é‡Šæ‰äº†ã€‚

**ä¿®æ­£**:
1.  åœ¨ `onEnable` æ·»åŠ  `manager.loadWeapons()`ã€‚
2.  æ¢å¤ `data == null` æ—¶çš„ Warning æ—¥å¿—ã€‚
